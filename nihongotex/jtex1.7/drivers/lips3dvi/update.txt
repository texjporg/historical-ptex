		  lips3dvi(Ver 2.09) リリースノート

						         1992年2月9日
						 (有)ＮＳプランニング
							     長原宏治

lips3dvi V2.09をリリースいたします。このドキュメントでは、以前の一般リ
リース版(Ver 1.06)からの変更点を述べます。

【1】 バグフィックス

(1) ダウンロードした0x20の文字が印刷されない。
LIPS3では、ユーザー文字セットに0x20をコードとする文字があっても、それ
を印刷する方法がありません。lips3dviでは、ほとんどの欧文フォントをユー
ザー文字セットとしてダウンロードしますので、0x20の文字が印刷されないと
いう症状が発生していました。Ver 2.Xでは、0x20の文字を常にビットマップ
として転送することにより、このLIPS3の制約を回避しています。
これに伴い、ダウンロードインフォファイル(.fontinfo)の書式が変更されま
した。具体的には、ダウンロードインフォファイルファイルの各エントリに、
そのフォントの0x20の文字情報が追加されています。従って、旧版で作成した
ダウンロードインフォファイルは使えません。最初にVer 2.00をお使いになる
時には、-fオプションを使って既存のダウンロードインフォファイルを無視さ
せて下さい。

(2) dviprにて-s/-eオプションに0を指定するとエラーになる。
単純な引数評価のミスでした。

(3) lprmされると作業ファイルが残ってしまう。
lipsbackにてSIGINTをトラップし、中間ファイルを削除するようにしました。

(4) ドキュメント全体にmagを掛けると間延びした出力となる。
DVI内にドキュメント全体にmagを掛ける指示があると、全体に間延びした出力
となってしまうバグがありました。DVIのmag指定を正しく利用するように修正
されています。

(5) dviprがコアを吐くことがある。
dviprを、ファイル名を指定せずに起動するとコアを吐いていましたが、usage
を表示するように修正されています。

(6) 文字が1つもないドキュメントが印刷できない。
罫線だけで文字を1つも含まないドキュメントを印刷することができませんで
したが、印刷が行なえるように修正されています。

(7) ダウンロードできないフォントセットがある。
極く一部なのですが、0x20にグリフを持たないフォントセット、ならびに0x20
の文字ピッチが8ドット以下になってしまうフォントセットにおいては、ダウ
ンロードしたデータがプリンタ側で無視されてしまうという障害がありました。
LIPS3において、0x20の送りピッチが8未満の場合には、そのダウンロードフォ
ント全体を無視してしまうためです。この条件にあてはまるフォントの場合に
は、適当なピッチを指定するように修正されています。

(8) チェックサムが一致しない場合のワーニング
DVIファイルに埋め込まれたTFMファイルのチェックサムと、印刷時に読み込む
グリフファイルのチェックサムが一致しない場合には、ワーニングメッセージ
が表示されますが、DVI内のチェックサムが0の場合にはチェックを行なわない
のが仕様であることが分かりました。これに従って、DVI内のチェックサムが0
の場合にはチェックを行なわないようにしました。なお、アスキーからのディ
ストリビューションを使い、マニュアルに従ってインストールした場合には、
DVI内のチェックサムは0になっています。

(9) ポストアンブルには無いフォントエラー
稀に、'font xxx is not defined in postamble.  abort'のメッセージが表示
され、プログラムが停止してしまうことがありました。これは、「フォント番
号が昇順に定義されていない」DVIファイルにおいて、このような症状が起き
ていたものです(dviselectなどで分割したDVIファイルなどが、このような性
質を持つことがある)。内部的に記憶したフォントデータの検索にバグがあっ
たためで、正しく検索が行なわれるように修正されています。

(10) DOSにおける文字抜け
プリンタBIOSの戻り値をチェックしていなかったため、BIOSレベルでプリンタ
タイムアウトが発生した場合に、文字抜けが起きていました。BIOSの戻り値を
チェックし、タイムアウトした場合には無限にリトライするように修正されて
います。副作用として、プリンタがオンラインにならないとプログラムを強制
終了させることができませんので御注意ください。

(11) 綴りミスの訂正
ペーパーサイズの指定にて、リーガルをLIGALと綴っていましたが、LEGALと修
正しました。またポートレイトをportrateと綴っていましたが、portraitと修
正しました。コマンドライン、コンフィギュレーションファイルの両方で、誤っ
た綴りを使うことはできませんので、御注意ください。

(12) 印字原点座標のデフォールト値
LIPS3におけるデフォールトの印字原点座標値の指定を間違っていました。コ
ンフィギュレーションファイルにて、porth_base, portv_base, landh_base,
landv_baseを指定していない場合には、ズレが発生することがありますが、そ
の量はごくわずかです。

(13) プリンタイニシャライズコマンドの訂正
LIPS3におけるプリンタ初期化命令の1つである「テキストモード開始」コマン
ドの指定が誤っていました。


【2】 機能拡張など

(1) pTeXのサポート
pTeX(縦書きTeX)の出力する拡張DVIファイルをサポートしました。ただし、縦
書き用和文グリフファイルの仕様などが未定のため、縦書きの場合にはプリン
タに内蔵のフォントしか使うことができません。(-jオプションは無視されま
す)。

(2) 代用フォント指定
pTeXの和文マルチフォント機能に対応するために、代用フォントを指定する機
能を追加しました。具体的には、コンフィギュレーションファイルに以下のエ
ントリを書くことができます。

	font	<フォント名>	<フォント属性>

<フォント名>には、和文フォントの名称を指定します。例えば、縦書き用明朝
体ならば'tmin'です。DVIにあるフォント名の先頭部分と、この<フォント名>
が一致した場合に、そのフォントの文字は次の<フォント属性>で指定される内
蔵フォントで印刷されます。
<フォント属性>には、そのフォントを印刷する時の内蔵フォント属性を指定し
ます。
	J<フェイス番号>		LIPS3における書体番号を指定します。
				LIPS3では、80が明朝体、81が角ゴチック
				体、82が丸ゴチック体です。
				ESC/Pageでは、10が明朝体、9が角ゴチッ
				ク体です。
	W<ストローク番号>	LIPS3におけるストロークウェイト番号を
				指定します。ESC/Pageでは線幅を指定しま
				す。
				LIPS3では、22がMidium、2がLight、1が
				Boldです。明朝、角ゴチックはMidium、丸
				ゴチックはLightになります。その他のフォ
				ントについては、フォントカードのマニュ
				アルを参照して下さい。
				ESC/Pageでは、0がノーマル、2がボールド、
				1がその中間です。明朝と角ゴチックでは0
				か1を指定できます。
	T			縦書き用フォントであることを示しますが、
				現版では未使用です。
	Y			横書き用フォントであることを示しますが、
				現版では未使用です。
	F<フィルパターン番号>	LIPS3の文字修飾機能の1つに、文字の内部
				を特定のパターンで塗りつぶすことができ
				ます。この機能を使って、文字修飾を行な
				う場合に、そのパターン番号を指定します。
				ESC/Pageではこのパラメータは無視されま
				す。
	S<シャドウパターン番号>	LIPS3の文字修飾機能の1つに、文字に影を
				付けることができます。その文字修飾を行
				なう場合に、その影のパターン番号を指定
				します。
				ESC/Pageではこのパラメータは無視されま
				す。
	O<輪郭線幅>		LIPS3の文字修飾機能の1つに、輪郭線だけ
				で文字を書く機能があります。その文字修
				飾を行なう場合に、輪郭線の幅をドット数
				で指定します。
				ESC/Pageではこのパラメータは無視されま
				す。

なお、前版とのコンパチビリティのために、minchoface/gothicfaceも使えま
すが、できるだけこのfont命令にて指定するようにして下さい。
また、min*/goth*以外のフォント(例えばtmin*やtgoth*)は、全てこのfont命
令で指定しなくてはなりません。とりあえず、pTeXを利用する場合には、コン
フィギュレーションファイルに以下の行を記入しておいて下さい。
LIPS3の時:
	font	tmin	J80TW22	# Tategaki Mincho
	font	tgoth	J81TW22	# Tategaki Gothic
ESC/Pageの時:
	font	tmin	J10TW0	# Tategaki Mincho
	font	tgoth	J9TW0	# Tategaki Gothic

LIPS3にてオプションのゴチックフォントカートリッジをお持ちでない場合に
は、例えば次のように指定すると、ゴチック体を指定した部分が影付き文字で
印刷されます。確認のためには便利に使えることと思います。
	font	goth	J80W22S3

<フィルパターン番号>、<シャドゥパターン番号>には、LIPS3の内蔵パターン
を指定して下さい。ユーザーパターンを登録する機能はありません。内蔵パター
ンについては、「プログラマーズマニュアル コマンドリファレンス」P.269
(矩形領域網掛け開始命令)を参照して下さい。

注:一般への非公開版であるV2.02では、font文の後ろに空白またはタブがなけ
ればSyntaxエラーとなっていましたが、この版では修正されています。

(3) コピー部数指定
コピー部数を指定するオプションを追加しました。コピーはLIPS3の機能を使っ
て実現されていますので、2部以上の印刷を行なう場合にこのオプションを使
うと、高速に出力されます。具体的には
	-c <コピー部数>
をオプションとして指定します。コンフィギュレーションファイルで指定する
ことはできません(意味もないでしょう)。


(4) 強制ダウンロード
強制ダウンロード(forcedownload yes / -f)を指定した場合には、プリンタを
ハードリセットし、既登録済みのフォントを削除するようにしました。他のプ
ログラムで、オーバーレイなどを登録している場合には、それらも削除されて
しまいますのでご注意下さい。


(5) フォントサーチパス
フォントサーチパスをコンフィギュレーションファイルで複数指定できるよう
になりました。以下の例のように、fontdir/tfmdirにおいて、ディレクトリを';'
で区切って指定して下さい。
	fontdir	/usr/local/lib/tex/pkfont;/usr/local/lib/tex/jxlfont
	tfmdir	/usr/local/lib/tex/tfm;/usr/local/lib/tex/jfm
なお、DOS版において、環境変数では複数のディレクトリを指定することはで
きません。


(6) DOSにおけるフォントサーチパス	(V2.05の新機能)
DOSにおけるフォントサーチパスを次のように変更しました。旧版からの互換
性は保たれていますが、今後はディレクトリ名にフォントタイプを含むものを
中心に考えてゆく予定です。詳しくはマニュアルをご覧下さい。
  1. $FONTDIR/<拡大率>/<フォント名>.far
  2. $FONTDIR/<拡大率±1>/<フォント名>.far
  3. $FONTDIR/<拡大率>/<フォント名>.pxl
  2. $FONTDIR/<拡大率±1>/<フォント名>.pxl
  4. $FONTDIR/<拡大率>pxl/<フォント名>.pxl
  5. $FONTDIR/<拡大率±1>pxl/<フォント名>.pxl
  6. $FONTDIR/<解像度>pk/<フォント名>.pk
  7. $FONTDIR/<拡大率>/<フォント名>.pk
  8. $FONTDIR/<拡大率±1>/<フォント名>.pk


(7) ESC/Pageへの対応			(V2.07の新機能)
EPSON製LP-3000のコマンドであるESC/Pageに対応しました。この対応は岩本氏
の作業によるものです。config.hにて、ESCPを1に設定し、makeにてescpdviの
作成を指示すると、escpdvi(.exe)ができます。また、lipsbackもescpdviに対
応したものができます。これに伴い、config.hファイルの指定方法が若干代わっ
ています。また、lips3dviとescpdviでは、ダウンロードインフォファイルに
互換性がありません。なお、リリース作業者はESC/Pageを使用することができ
ないので、escpdviのテストは不十分です。


(8) DOS版のEMSへの対応			(V2.07の新機能)
DOS版において、展開したビットマップパターンをEMSメモリ上に保持する機能
が追加されました。この対応は岩本氏の作業によるものです。config.hにて、
USEEMSを1に設定すると、EMSを使用するものができます(lips3dvi、escpdviの
双方に有効)。EMS対応としてコンパイルしたプログラムでは、ビットマップを
まずEMSに展開しようとし、EMSが無くなるとメインメモリを使用します。


(9) DOS/Vへの対応			(V2.07の新機能)
DOS/Vでも実行できるようになりました。DOS/VはBIOSにフックし、常に漢字コー
ドの変換を行なうため(漢字コード変換を無効化することができない)、論理デ
バイスLPT1:のポートアドレスを調べて、ハードウェアを直接制御します。従っ
て、ネットワークプリンタでは使用できません。


【3】  V2.09からV2.09aへの変更点
V2.09リリースの直前に、DOS版におけるEMSサポートルーチンの初期化ルーチ
ンを削ってしまいました。V2.09aでは、EMSサポートルーチンを正しく呼び出
す様に訂正してあります。なお、この修正はUNIX版には一切影響を及ぼしませ
ん。

また、V2.09配付の際に、lips3dvi.cnfを配付し忘れました。V2.09aへのパッ
チには、この不足していたファイルも追加されています。

【4】 Special Thanks to

バグフィックス/機能拡張などにあたって、以下の方々から貴重な御意見、御
指摘を頂きました。心よりお礼申し上げます。
	小林様(東京書籍)
	東田様(東京工業大学)
	沼口様(東京大学)
	坂下様(アステック)
	山本景三様(名古屋大学)
	山田祥平様
	吉崎栄泰様
	日下部陽一様(グローバルサイエンス)
	鷺谷好輝様(アスキー)
	岩本明氏
								以上
