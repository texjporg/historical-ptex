\documentstyle[a4j]{jarticle}

\newcommand{\KK}{{\small (株)}}
\newcommand{\YK}{{\small (有)}}
\newcommand{\niko}{♪}
\newcommand{\LIPS}{{LIPS3}}
\renewcommand{\ast}{$*$}
\newcommand{\ob}{\verb+[+}
\newcommand{\cb}{\verb+]+}
\newcommand{\pTeX}{p\TeX}
\newcommand{\mf}{METAFONT}
\newcommand{\midashi}[1]{\vspace{3mm}\noindent{\bf #1}\par}
\setlength{\parskip}{1mm}

\title{lips3dvi取り扱い説明書\\Ver. 2.09}
\date{1992年2月9日}
\author{\KK アスキー\\濱野尚人\and\YK NSプランニング\\長原宏治}

\begin{document}

\maketitle

\section{lips3dviの構成}

\subsection{特徴}

lips3dviは、\TeX の出力であるDVIを、キヤノンの新型レーザービームプリン
タの制御言語である\LIPS に変換するプログラムです。つまり、このプリンタ
ドライバを使うことで、\TeX の出力を\LIPS を制御言語とするプリンタに対
して出力することができます。また、V2.07からはエプソンのESC/Page
(LP-3000)に対応したプログラムescpdviも同時に提供されます。このドキュメ
ントの内容は、特別の記述が無い限り、lips3dviとescpdviの両方にあてはま
ります。

lips3dviは、\TeX のプリンタドライバとして、以下のような特徴を持っ
ています。
\begin{itemize}
\item	ASCIIの日本語\TeX に対応(新版で\pTeX にも対応した)。
\item	欧文フォントには、pkならびにpxlフォントを使用可。pxlフォン
トでは、IDが1002/1003の圧縮形式も利用できる。
\item	和文フォントには、プリンタの内蔵スケーラブルフォント、な
らびに、JXL4フォーマットの大日本フォントを切り替えて利用できる。
\item	欧文フォントを完全にプリンタにダウンロードしてしまうことに
より、和文内蔵フォントとの組み合わせ使用では非常に高速。
\item	landscapeモードに対応。
\item	印刷時に拡大・縮小の指定が可能。ただし、適当な大きさの欧文
フォントが必要(和文フォントはスケーラブルなので無くても可)。
\item	MS-DOSでも動作可能。\footnote{MS-DOS版では{\bf 日本語
micro\TeX}の{\bf FARフォーマット}にも対応している。}
\end{itemize}


\subsection{全体構成}

現在の版のlips3dviは、UNIXでの動作を主眼としていますので、UNIXの標
準的なプリンタスプーラを利用するために、以下の3つのプログラムで構
成されています。
\begin{itemize}
\item フロントエンド・プログラム〜dvipr
\item バックエンド・プログラム〜lipsback
\item 変換プログラム本体〜lips3dvi(escpdvi)
\end{itemize}

dviprは、UNIXでの標準的なコンベンションに従ったコマンドをユーザー
から受け取ります。dviprでは、オプションを解析し、それが正しければ、
そのオプションとDVIファイルの内容を、パイプを通してUNIXの標準的な
プリンタスプーラであるlprに引き渡します。

lipsbackは、UNIXのプリンタスプーラデーモンlpdのフィルタプログラムとし
て動作します\footnote{DVIをプリントするためのフィルタプログラムである
ので、printcapの{\it df\/}エントリにて指定される。}。lpdは受け取ったファ
イルを標準入力としてlipsbackを起動します。lipsbackは、入力を
lips3dvi(escpdvi)へのオプションとDVIファイル本体とに分離します
\footnote{DVIファイルの本体は一時ファイルとしてtmpディレクトリに書
き出される。}。その後、受け取ったオプションを付けたlips3dvi(escpdvi)をfork
し、その実行が終了するのを待った上で一時ファイルを削除します。

lips3dvi(escpdvi)がプリンタドライバの本体です。UNIX版においては、
lipsbackから与えられたアーギュメントを解釈し、同じくlipsbackがtmpディ
レクトリに作成したDVIファイル本体にアクセスしますし、DOS版においては
lips3dvi(escpdvi)が単体でDVIファイルへアクセスします。

これらの処理の流れをまとめますと、次のようになります。
\begin{enumerate}
\item	dviprが引数を解釈し、正しければ引数とDVIファイル本体を
1つの出力ストリームにまとめて、lprに引き渡す。
\item	lprは、必要に応じてネットワークを経由した上で、プリンタサ
ーバーとなるマシンの上でlipsbackを起動する。
\item	lipsbackは入力ストリームを{\bf 引数}と{\bf DVIファイル本
体}に分離し、lips3dvi(escpdvi)を起動する。
\item	lips3dvi(escpdvi)は引数に従ってDVIファイルを\LIPS (ESC/Page)に
変換して出力する。
\end{enumerate}
つまり、lprはフィルタプログラムに対して引数を受け渡す方法を提供さして
いない事を回避するために、dviprとlipsbackが引数をデータストリームの中
に押し込んで伝達する働きをするわけです。lips3dvi(escpdvi)は、それ単体
で全ての変換を行いますので、lprを利用する必要がないDOS版では、
lips3dvi(escpdvi)だけで動作します。


\section{lips3dvi〜プリンタドライバ本体}

\subsection{機能}

lips3dvi(escpdvi)は、コンフィギュレーションファイルならびに、コマンド引数
を読み取り、その指示に従ってDVIを含む必要なファイルにアクセスし、
\LIPS (ESC/Page)のコマンドシーケンスを書き出します。出力はUNIX版においては
標準出力に書き出されますし、DOS版においてはROM BIOSを利用する事によっ
て直接プリンタに送り出されます。\footnote{DOSのプリンタドライバでは、
漢字コード変換を行わずにプリンタにデータを送る方法が提供されていないた
めにBIOSを直接利用します。従って、プログラムはハードウェアに依存します。
また、DOS/VではBIOSが漢字コード変換を行い、かつそれを禁止する方法が提
供されていないため、論理デバイス`LPT1:'が割り当てられているハードウェ
アポートに直接アクセスします。ネットワークプリンタを使用することはでき
ませんのでご注意ください。}

lips3dviの動作を指定するパラメータを決定するために、以下がこの順番
で参照されます。それぞれの詳細は後に述べられています。
\begin{enumerate}
\item	コンフィギュレーションファイルを指示する環境変数(LIPS3DVI)
\item	コンフィギュレーションファイル
\item	環境変数(DOS版のみ)
\item	コマンド行の引数
\end{enumerate}

lips3dvi(escpdvi)の実行は、以下に示す2つの大きなフェイズに分かれていま
す。
\begin{itemize}
\item	DVIのポストアンブルを読みとり、必要なフォント情報をメモリ
に取り込むと共に、必要に応じてプリンタにダウンロードする。
\item	DVIの本体を読みながら、\LIPS (ESC/Page)のコマンドを出力してゆ
く。
\end{itemize}

ダウンロードフェイズでは、以下のような処理が行われます。
\begin{itemize}
\item	ポストアンブルを読み、必要なフォントをリストアップする。
\item	以後の作業に備えて、使用されているフォントのtfmを、メモリ
に読み込む。
\item	プリンタにダウンロード済みのフォントを調べ、まだダウンロー
ドされていない欧文フォントがあれば、グリフファイル(PXLまたは
PK\footnote{DOS版においては{\bf 日本語micro\TeX}のFARも使用可。})を展
開してダウンロードする。
\item	プリンタのメモリ不足でダウンロードしきれない場合には、展開
済みのビットマップ情報をメモリに保持し続ける\footnote{DOSのEMS対応版で
は、EMSメモリを優先的に使用します。}。
\item	プリンタにダウンロードしたフォントに関する情報をファイルに
記録する。
\item	和文フォントに大日本フォントを利用することが指定されていた
場合には、グリフファイル(JXL4)から各キャラクタのサイズ、グリフのフ
ァイルにおける位置などを読み込んでメモリに保持すると共に、キャッシ
ュシステムの準備を行う。
\end{itemize}

フォントのダウンロードは、それだけで{\bf プリンタの1つのジョブ}として
処理されます。また、ダウンロードされたフォントは、プリンタ側で{\bf 永
久登録}されます。ダウンロードされたデータをプリンタのメモリから消去す
るには、プリンタの電源を落とすか、{\bf ハードリセット}を行う事が必要で
す\footnote{逆に、他のフィルタがプリンタにハードリセットコマンドを送ら
ないように設定しなくてはなりません。}。なお、lips3dviではフォントのダ
ウンロードを行っている時には、ダウンロード中のフォントの名称が、プリン
タのパネルに表示されます(escpdviでは表示されない)。

プリントフェイズでは、ダウンロードフェイズにおいてメモリ中に読み込
んだデータを使って、以下のような処理を行っていきます。
\begin{itemize}
\item	{\bf フォントの選択}を高速に行えるように\footnote{\LIPS
では、フォントに予め番号を割り当てておくと、その番号だけでフォント
の呼び出しを行う事ができる。特に内蔵のスケーラブルフォントを呼び出
す場合には、予め番号を割り当てると高速になる。}、プリンタで使用す
るフォント番号を割り当てる。ESC/Pageでも同様である。
\item	DVIファイルを先頭から読み込みながら、各ページを印刷してゆ
く。この時、印字位置の計算には、ダウンロードフェイズで読み込んだ
tfmのデータを使用する。また、実際の印字では
\begin{itemize}
\item	和文の内蔵フォントないしダウンロード済みの欧文フォントの場
合には、その文字コードを
\item	和文の大日本フォントないしはダウンロードされていない欧文フ
ォント\footnote{サイズが\LIPS の制限を越えるものはダウンロードされない。}
の場合には、そのイメージをビットマップデータとして
\end{itemize}
転送する。
\end{itemize}

なお、大日本フォントのビットマップデータは、キャッシュシステムを経
た上で、必要に応じてグリフファイルから読み込まれます。データ転送量
が膨大となるため、印刷には長い時間がかかります。

パラメータによって、印刷するページが指定されている場合には、印刷する必
要の無いページのデータは、単純に読み飛ばされます。


\subsection{コンフィギュレーションファイル}

lips3dviは、実行に先だってコンフィギュレーションファイルから、さまざま
なオプションを読みとります。コンフィギュレーションファイルの名称は、環
境変数{\bf LIPS3DVI}によって指定することができます\footnote{UNIX版では
lips3dviはデーモンから起動されますので環境変数は無意味です\niko 。}。
デフォールトのファイル名が気に入らない場合は、環境変数{\bf LIPS3DVI}に
コンフィギュレーションファイルの完全な名称(フルパス名)を設定しておきま
す。あるいは、インストール(コンパイル)時に読みとるコンフィギュレーショ
ンファイルの名称を変更することもできます。

コンフィギュレーションファイルによって、利用環境に応じた細かな設定を行
う事ができ、印刷の度に煩雑なオプション指定をする必要がなくなります。ま
た、コンフィギュレーションファイルでしか指定できないパラメータもありま
す。

コンフィギュレーションファイルは、通常のテキストファイルです。空行
と第1カラム目が``{\tt \#}''の行はコメントとみなされます。コンフィギ
ュレーションファイルには、1行に1つのコマンドを記入する事ができます。
コマンドの後から行末までは無視されますので、そこにコメントを書く事
もできます。なお、コマンドとは見なせない行があると、エラーメッセー
ジを表示します。

\vspace{3mm}\noindent{\bf start 印刷開始ページ番号}\\
{\bf end 印刷終了ページ番号}\\
印刷するページ番号を指定します。ページ番号は、\TeX によって与えら
れる論理的なページ番号であり、物理的なページ番号ではありません。文
書の途中で論理ページのリセットが行われる場合であっても、指定された
論理ページ番号を持つ全てのページが印刷されます。デフォールトは
{\bf start}が$-1$(指定しない)、{\bf end}が{\it Maxint\/}(指定しない)です。

\vspace{3mm}\noindent{\bf paper {\tt
\{A4,A5,B4,B5,Hagaki,Letter,Legal,User\}}}\\
印刷を行う用紙のサイズを指定します。{\tt User}\/を指定した場合には、
実際の用紙の大きさを{\bf p\_width}と{\bf p\_height}コマンドで指定し
なくてはなりません。なお、これらの用紙サイズの指定は、そのままプリ
ンタに伝えられるだけですので、lips3dviの動作には影響を及ぼしません。
プリンタは、この指示に従ってペーパートレイの切り替えなどを行います。
デフォールトは{\tt A4}\/です。

なお、旧版(V1.06)では、Legalを誤ってLigalと綴りミスしていましたが、本
版では修正されています。ミススペルのままではエラーとなりますので、御注
意下さい。

\vspace{3mm}\noindent{\bf p\_width 用紙の幅}\\
{\bf p\_width 用紙の高さ}\\
{\bf paper}命令で{\tt user}を指定した場合に、用紙の幅と高さをmmを
単位として指定します。

\vspace{3mm}\noindent{\bf landscape}\\
{\bf portrait}\\
用紙に対する印字方向を指定します。デフォールトは{\bf portrait}です。

\vspace{3mm}\noindent{\bf porth\_base 印字原点水平座標}\\
{\bf portv\_base 印字原点垂直座標}\\
ポートレイトで印刷する場合に、印字開始原点の位置座標をドットを単位とし
て指定します。\LIPS におけるデフォールトは、{\bf porth\_base}が240(用
紙の左端から1inch)、{\bf portv\_base}が177(用紙の上端から1inch)です。
ESC/Pageにおけるデフォールトは{\bf porth\_base}が240(用紙の左端から
1inch)、{\bf portv\_base}が240(用紙の上端から1inch)です。プリンタのば
らつきに応じた指定が必要です。

\vspace{3mm}\noindent{\bf landh\_base 印字原点水平座標}\\
{\bf landv\_base 印字原点垂直座標}\\
ランドスケープで印刷する場合に、印字開始原点の位置座標をドットを単位と
して指定します。\LIPS におけるデフォールトは、{\bf landh\_base}が240
(用紙の左端から1inch)、{\bf landv\_base}が177(用紙の上端から1inch)です。
ESC/Pageにおけるデフォールトは、{\bf landh\_base}が240(用紙の左端から
1inch)、{\bf landv\_base}が240(用紙の上端から1inch)です。プリンタのば
らつきに応じた指定が必要です。

\vspace{3mm}\noindent{\bf h\_offset 印字位置水平オフセット}\\
{\bf v\_offset 印字位置垂直オフセット}\\
全体的に印字位置をずらしたい場合に、ずらす長さをmmを単位として指定
します。{\it オフセット値\/}には、負数や小数点付きの数値を指定する
事ができます。ずれる方向は、{\it オフセット値\/}が正の場合には、下
(垂直)ないし右(水平)です。いずれもデフォールトは0です。

\vspace{3mm}\noindent{\bf magnification 拡大率}\\
全体的に拡大縮小を行いたい場合に、その拡大率を指定します。{\it 拡
大率\/}には小数点付きの正数を指定する事ができますが、その拡大率に応
じたフォントが存在しなくてはなりませんので、必然として指定できる値
は限定されます。デフォールトは1.0です。

\vspace{3mm}\noindent{\bf jxlfont \{yes,no\}}\\
和文フォントとしてJXL4フォーマットの大日本フォントを使用するか否か
を指定します。{\it yes\/}を指定すると、可能な限り大日本フォントを
使用しますが、適当なフォントファイルが無い場合には内蔵フォントで代
用します。デフォールトは{\it no\/}です。

なお、縦書き用和文グリフファイルの仕様、配付方法などが未定のため、縦書
きの場合はJXL4フォントを使うことができません。縦書きの場合、このオプショ
ンは無効となり、常にプリンタ内蔵フォントが使われます。

\vspace{3mm}\noindent{\bf downloadsize 最大ダウンロードサイズ}\\
プリンタにダウンロードできるデータサイズを、バイトを単位として指定
します。プリンタに実装されているメモリが少なく、「ダウンロードオー
バー」のメッセージが頻繁に表示される場合には、コンフィギュレーショ
ンファイルでこのコマンドを指定します。使用する欧文フォントが、この
コマンドで指定した量よりも多くなる場合には、ダウンロードできなかっ
たフォントについては、文字ごとにビットマップデータが転送されます。
デフォールトは$-1$(無制限)です。

\vspace{3mm}\noindent{\bf fontdir フォントファイルのディレクトリ}\\
フォントファイルがあるディレクトリを指定します。lips3dviは、ここで
指定したディレクトリからグリフファイルを読み込もうとします。デフォ
ールトはコンパイル時に決定します。

旧版では、ここに1つのディレクトリしか指定することができませんでしたが、
本版からは複数のディレクトリを指定することができます。複数のディレクト
リを指定する場合には、サーチしたいディレクトリ名をセミコロン(``;'')で
区切ります。

\vspace{3mm}\noindent{\bf tfmdir フォントファイルのディレクトリ}\\
TFMファイルがあるディレクトリを指定します。lips3dviは、ここで指定
したディレクトリからTFMファイルを読み込もうとします。デフォールト
はコンパイル時に決定します。

旧版では、ここに1つのディレクトリしか指定することができませんでしたが、
本版からは複数のディレクトリを指定することができます。複数のディレクト
リを指定する場合には、サーチしたいディレクトリ名をセミコロン(``;'')で
区切ります。

\vspace{3mm}\noindent{\bf infofile ダウンロードインフォファイル名}\\
lips3dvi(escpdvi)は、プリンタにダウンロードした欧文フォントの名称やそ
のサイズなどをファイルに記録しておき、それを参照して次回にダウンロード
すべきフォントなどを決定します。このコマンドでは、そのフォント情報を記
録しておくファイルの名前を指定します。デフォールトはコンパイル時に決定
します。なお、このダウンロードインフォファイルは、lips3dviとescpdviに
て内容が異なりますので、互換性はありません。

\vspace{3mm}\noindent{\bf forcedownload \{yes,no\}}\\
{\bf infofile}を無視して、必要な全てのフォントをダウンロードする事
を指定します。{\it yes\/}が指定されたならば、全てのフォントをダウ
ンロードします。デフォールトは{\it no\/}です。プリンタの電源を落と
した時や、ハードリセットを行った時に指定します。

旧版では、このオプションを指定しても、プリンタに既登録のフォントは削除
されませんでしたので、このオプションを不必要に指定すると「ダウンロード
オーバー」となることがありました。本版では、このオプションを指定すると、
プリンタをハードリセットして全てのフォントを削除します。ただし、副作用
として、プリンタに登録されているオーバーレイなども全て削除されてしまい
ます。他のアプリケーションが、オーバーレイなどを利用している場合には、
このオプションを指定しないようにして下さい。

\vspace{3mm}\noindent{\bf verbose \{yes,no\}}\\
著作権や作業の進行具合を表示する事を指定します。{\it yes\/}を指定
すると、標準エラー出力にそれらが表示されます。UNIX版でのデフォール
トは{\it no\/}です。MS-DOS版のために用意されているものですので、UNIX
版では指定しないでください\footnote{syslogにメッセージが表示される
ので邪魔になります。}。また、MS-DOS版ではデフォールトが{\it yes\/}と
なっています。

\vspace{3mm}\noindent{\bf minchoface 明朝体の書体番号}\\
プリンタにおける{\bf 明朝体の書体番号}を指定します。内蔵フォントを使っ
て和文を印刷する場合、明朝体はこの書体番号を持つフォントで印刷されます。
\LIPS のデフォールトは80で、ESC/Pageのデフォールトは10です。このコマ
ンドを使う必要は無いはずです。このコマンドは、旧版との互換性のために用
意されていますので、できるだけ使わないようにしてください。

\vspace{3mm}\noindent{\bf gothicface ゴチックの書体番号}\\
プリンタにおける{\bf ゴチックの書体番号}を指定します。内蔵フォントを使っ
て和文を印刷する場合、ゴチックはこの書体番号を持つフォントで印刷されま
す。\LIPS のデフォールトは81の{\gt 角ゴチック}です。\LIPS で{\gt 丸ゴ
チック}のフォントを使用したい場合は、82を指定してください。また、角ゴ
チック、丸ゴチックのいずれも実装していない場合には、80を指定しておけば
明朝体で印刷されます。ESC/Pageのデフォールトは9の角ゴチックです。この
コマンドは、旧版との互換性のために用意されていますので、できるだけ使わ
ないようにしてください。

\vspace{3mm}\noindent{\bf font 和文フォント名 フォント属性}\\
\pTeX のマルチフォント機能に対応するためにV2.00で追加された機能で、
\TeX で使っている和文フォントを、LaserShot(LP-3000)の内蔵フォントに対
応付けます。 {\bf フォント名}には、\TeX で使っている和文フォントの名称
を指定します。例えば、\pTeX のデフォールト縦書き明朝体であれば``tmin''
となります。DVIにあるフォント名の先頭部分と、この{\bf フォント名}が一
致した場合に、そのフォントは次に述べる{\bf フォント属性}を持った内蔵フォ
ントで印刷されます。

{\bf フォント属性}には、指定されたフォントの代わりに使用する
LaserShot(LP-3000)内蔵フォントの属性を指定します。次の属性が使用できま
す。
\begin{description}
\item[Jフェイス番号]	\LIPS ならびにESC/Pageにおける書体番号を指定し
ます。\LIPS では80が明朝体、81が角ゴチック体(オプション)、82が丸ゴチッ
ク体(オプション)です。ESC/Pageでは10が明朝体、9が角ゴチック体です。
\item[Wストロークウェイト番号]	\LIPS におけるストロークウェイトを指定
します。1がボールド、2がライト、22がミディアムです。省略した場合には、
22(ミディアム)となります。ESC/Pageで線幅を指定することで同等の機能を実
現しています。0がノーマル、2がボールド、1がその中間です。
\item[T]	縦書き用フォントであることを示しますが、本版では未使用
です。
\item[Y]	横書き用フォントであることを示しますが、本版では未使用
です。
\item[Fフィルパターン番号]	\LIPS の文字修飾機能の1つとして、文字
の内部を特定のパターンで塗りつぶす機能があります。その機能を使って、文
字修飾を行なうことができ、このパラメータで塗りつぶすパターン番号を指定
します。ESC/Pageでは、このパラメータは無視されます。
\item[Sシャドゥパターン番号]	\LIPS の文字修飾機能の1つとして、文字
に影をつける機能があります。その機能を使って、文字修飾を行なうことがで
き、このパラメータで影を塗りつぶすパターン番号を指定します。ESC/Pageで
は、このパラメータは無視されます。
\item[O輪郭線幅]	\LIPS の文字修飾機能の1つとして、文字の輪郭線
だけを描画する機能があります。その機能を使って、文字修飾を行なうことが
でき、このパラメータで輪郭線の幅をドット数で指定します。ESC/Pageでは、
このパラメータは無視されます。
\end{description}
なお、{\bf フィルパターン番号}、{\bf シャドゥパターン番号}には、\LIPS 
の内蔵パターン番号を指定します。内蔵パターン番号については、「プログラ
マーズマニュアル コマンドリファレンス」p.269(矩形領域網掛け開始命令)を
参照してください。\footnote{添付のpatlist.cの出力結果を\underline{直接}
LaserShotに送り込むと、パターンリストが印刷されます。詳しくは付録を参
照してください。}

デフォールトでは、次の2つのエントリが組み込まれています。
\begin{verbatim}
    FONT    min     J80W22Y        #横書き明朝  (LIPS)
    FONT    goth    J81W22Y        #横書きゴチック  (LIPS)

    FONT    min     J10W0Y         #横書き明朝  (ESC/Page)
    FONT    goth    J9W0Y          #横書きゴチック  (ESC/Page)
\end{verbatim}
また、\pTeX の縦書き機能を使う場合には、次の2行を追加します。これらの
エントリは、デフォールトでは使えません。
\begin{verbatim}
    FONT    tmin    J80W22T        #縦書き明朝  (LIPS)
    FONT    tgoth   J81W22T        #縦書きゴチック  (LIPS)

    FONT    tmin    J10W0T         #縦書き明朝  (ESC/Page)
    FONT    tgoth   J9W0T          #縦書きゴチック  (ESC/Page)
\end{verbatim}

\LIPS で、オプションのゴチックカートリッジをお持ちでない場合には、次の
ようなエントリを追加すると、原稿中でゴチックと指定された文字が「明朝の
影付き文字」で印刷されます(lips3dviのみ)。確認のためには、便利に使える
ことと思います。
\begin{verbatim}
     FONT    goth   J80W22S3       #横書きゴチック→影付き明朝
\end{verbatim}

なお、これらの代用フォント機能は、内蔵フォントを利用する場合にのみ有効
です。大日本フォントを使う場合には、原稿で指定された名前のフォントが必
要です。また、内蔵フォントを利用する場合であっても、指定されたTFMファ
イルがなければなりません。

\vspace{3mm}\noindent{\bf side \{both,even,odd\}}\\
奇数ページのみ、ないしは偶数ページのみの印刷を指定します。{\it both\/}
を指定すると全てのページが、{\it even\/}を指定すると偶数ページのみが、
{\it odd\/}を指定すると奇数ページのみが印刷されます。ページ番号は、
{\bf start}や{\bf end}と同様に、物理的なページ番号ではなく、論理的なペー
ジ番号となります。デフォールトは{\it both}です。通常、このパラメータを
コンフィギュレーションファイルに記入することはないでしょう。

\subsection{環境変数(DOS版のみ)}

DOS版のlips3dviは、コンフィギュレーションファイルを読み込んだ後で、
以下の環境変数を参照し、コンフィギュレーションファイルによる指定を
オーバーライドします。従って、これらの環境変数を指定しておく事によ
り、コンフィギュレーションファイルによらずにフォントを読み込むディ
レクトリを指定する事ができます。
\begin{description}
\item[FONTDIR]	グリフファイルが存在するディレクトリ
\item[TFMDIR]	TFMファイルが存在するディレクトリ
\end{description}

なお、環境変数で複数のディレクトリを指定する事はできません。


\subsection{オプション}

lips3dvi(escpdvi)は、コンフィギュレーションファイルを読み込んだ後に、
コマンドラインの引数を解釈して、コンフィギュレーションファイルによる指
定をオーバーライドします。従って、最もよく利用する指定をコンフィギュレー
ションファイルで行っておき、必要に応じてコマンドラインからその指定を変
更することができます。

lips3dvi(escpdvi)で使用できるオプションと、そのオプションに対応するコ
ンフィギュレーションファイルでのコマンドを以下に示します。この機能の一
覧は、誤った指定を行った場合に、画面に表示されます。

\begin{center}
\begin{tabular}{|c|c|}
\hline
オプション		& コマンド \\ \hline\hline
-c 印刷部数		& 印刷部数(オプション指定のみ)\\
-s 開始ページ		& start 開始ページ\\
-e 終了ページ		& end 終了ページ\\
-t 用紙サイズ		& paper 用紙サイズ\\
-h 用紙高さ		& p\_height 用紙高さ\\
-w 用紙幅		& p\_width 用紙幅\\
-l			& landscape \\
-p			& portrait \\
-x 水平位置		& h\_offset 水平位置\\
-y 垂直位置		& v\_offset 垂直位置\\
-m 拡大率		& magnification 拡大率\\
-j			& jxlfont yes \\
-i			& jxlfont no \\
-d ダウンロードサイズ 	& downloadsize ダウンロードサイズ\\
-f			& forcedownload yes \\
-F			& forcedownload no \\
-V			& verbose yes \\
-S			& verbose no\\
-E			& side even\\
-O			& side odd\\
\hline
\end{tabular}
\end{center}

コンフィギュレーションファイルにおける全ての指定を、コマンドライン
でも行う事ができるわけではないことに注意して下さい。


\subsection{フォントファイルの検索}

lips3dviは、各フォントのメトリック情報をメモリ中に保持するために、
TFMファイルを読み込みます。TFMファイルは、コンフィギュレーションフ
ァイルの{\bf TFMDIR}にて指定されたディレクトリから、DVIファイルの
FNT\_DEF命令で指定されたフォントに対応するものが検索されます。

lips3dviは、英文のフォントファイル全体を一気に読み込み、プリンタに
ダウンロードしようとします。英文フォントの読み込みにあたって、
lips3dviは以下のルールに従ってフォントファイルを探してゆきます。必
要なフォントファイルが見つかれば、それをメモリ上に読み込むわけです。
なお、コンパイル時にサポートするフォントファイルの形式を指定した場
合には、サポートしていない形式のフォントファイルの検索は行いません。

\begin{enumerate}
\item	UNIXの場合
\begin{enumerate}
\item	フォントのマグニフィケーションとプリンタの解像度からフォン
トの大きさを計算し、{\it mag\/}とする。また、{\it mag\/}を5倍した値を
{\it mag5\/}とする(実数で計算されるので、{\it mag\/}を単純に5倍した値
とはならないこともある)。
\item	コンフィギュレーションファイルにおける{\bf FONTDIR}で指定された
ディレクトリから{\bf フォント名.{\it mag\/$*5$}pxl}なるファイルを探す。
\item	同じディレクトリから{\bf フォント名.{\it mag5\/}pxl}なるファイ
ルを探す。
\item	{\it mag5\/}の計算誤差を考慮し、{\it mag5\/}を$\pm 1$してpxlフ
ァイルの検索を繰り返す。
\item	同じディレクトリから{\bf フォント名.{\it mag\/}pk}なるファイ
ルを探す。
\end{enumerate}
\item	MS-DOSの場合
\begin{enumerate}
\item	フォントのマグニフィケーションとプリンタの解像度からフォン
トの大きさを計算し、{\it mag\/}とする。また、{\it mag\/}を5倍した値を
{\it mag5\/}とする(実数で計算されるので、{\it mag\/}を単純に5倍した値
とはならないこともある)。
\item	コンフィギュレーションファイルの{\bf FONTDIR}で指定された
ディレクトリから{\it mag5\/}{\bf .far}なるファイルを探す。見つかれば、
そのフォントアーカイブを検索して必要なフォントの情報を取り出す。
\item	{\it mag5\/}の計算誤差を考慮し、{\it mag5\/}を$\pm 1$してfarフ
ァイルの検索を繰り返す。
\item	{\tt FONTDIR/\it mag5\/}なるディレクトリから、{\bf フォント名
.pxl}なるファイルを探す。
\item	{\tt FONTDIR/\it mag5\/\tt pxl}なるディレクトリから、{\bf フォント名
.pxl}なるファイルを探す。
\item	{\it mag5\/}の計算誤差を考慮し、{\it mag5\/}を$\pm 1$してpxlフ
ァイルの検索を繰り返す。
\item	{\tt FONTDIR/\it mag\/\tt pk}なるディレクトリから、{\bf フォント名
.pk}なるファイルを探す。
\item	{\tt FONTDIR/\it mag5\/}なるディレクトリから、{\bf フォント名
.pk}なるファイルを探す。
\item	{\it mag5\/}の計算誤差を考慮し、{\it mag5\/}を$\pm 1$してpkファ
イルの検索を繰り返す。
\end{enumerate}
\end{enumerate}

{\bf jxlfont yes}ないしは{\bf -j}オプションが指定された場合には、
lips3dviはJXL4形式のフォントファイルを読み込んで日本語の印刷を行い
ます。日本語のフォントファイルは、一気にメモリ中に読み込むには大き
すぎるので、そのフォントが初めて必要となった時に、必要最小限の情報
を読み込み、そのフォントの正確な名前と共にメモリに保持します。以後
は、必要に応じて同じフォントファイルがオープンされ、必要な情報を読
みとって、ファイルをクローズするという作業が繰り返されます。

最初に日本語のフォントファイルを読み込む場合には、以下のルールにし
たがってフォントファイルを探してゆきます。
\begin{enumerate}
\item	UNIXの場合
\begin{enumerate}
\item	フォントのマグニフィケーションとプリンタの解像度からフォン
トの大きさを計算し、{\it mag5\/}とする。
\item	コンフィギュレーションファイルにおける{\bf FONTDIR}で指定された
ディレクトリから{\bf フォント名.}{\it mag5\/}{\bf pxl}なるファイルを
探す。
\item	{\it mag5\/}の計算誤差を考慮し、{\it mag5\/}を$\pm 1$してJXL4フ
ァイルの検索を繰り返す。
\end{enumerate}
\item	MS-DOSの場合
\begin{enumerate}
\item	フォントのマグニフィケーションとプリンタの解像度からフォン
トの大きさを計算し、{\it mag5\/}とする。
\item	{\tt FONTDIR/\it mag5\/}なるディレクトリから、{\bf フォント名
.pxl}なるファイルを探す。
\item	{\it mag5\/}の計算誤差を考慮し、{\it mag5\/}を$\pm 1$してJXL4
ファイルの検索を繰り返す。
\item	{\tt FONTDIR/\it mag5\/\tt pxl}なるディレクトリから、{\bf フォ
ント名.pxl}なるファイルを探す。
\item	{\it mag5\/}の計算誤差を考慮し、{\it mag5\/}を$\pm 1$してJXL4
ファイルの検索を繰り返す。
\end{enumerate}
\end{enumerate}

lips3dviでは、以上で述べたルールに従ってもフォントファイルを見つけ
られなかった場合には、メッセージを表示して処理を中断します
\footnote{日本語フォントの場合には、プリンタ内蔵フォントでの代行を
行うので、処理は中断されません。}。メッセージでは、最後に検索した
フォントファイルの名前のみを表示しますので、ここで述べた検索順序を
参考にして、フォントファイルを見つけられなかった理由を調べて下さい。


\subsection{関連ファイル}

lips3dviは以下のファイルを利用します。

\begin{description}
\item[コンフィギュレーションファイル]	lips3dviの諸パラメータを決
定する。環境変数{\bf LIPS3DVI}によって指定される。デフォールトは、
``/usr/local/lib/tex/lips3dvi.cnf''(UNIX)、
``c:/tex/lips3dvi.cnf''(DOS)。
\item[ダウンロードインフォファイル]	プリンタにダウンロードしたフォ
ントの名称やサイズを記録する。コンフィギュレーションファイルの{\bf
infofile}によって指定される。デフォールトは
``/var/tmp/.fontinfo'' (UNIX)、``c:/tmp/download.fnt''(DOS)。\footnote
{旧版から一部の書式が変更されました。バージョンアップ後、初めて
lips3dviを実行するときには、``-f''オプションを指定して、このファイルを
無視させてください。}
\item[TFMファイル]	フォントのメトリック情報を保持する。コンフィギ
ュレーションファイルの{\bf tfmdir}で指定されたディレクトリから、
DVIファイルのフォント指定に従って参照される。
\item[グリフファイル]	フォントのグリフ(ビットパターン)情報を保持
する。コンフィギュレーションファイルの{\bf fontdir}で指定されたディ
レクトリから、DVIファイルのフォント指定に従って参照される。コンパ
イル時の指定により、PKフォーマット、PXLフォーマット、FARフォーマッ
トの3種類の形式を自動的に判別する。
\end{description}


\section{dvipr〜フロントエンドプログラム}

\subsection{機能}

dviprは、UNIXの標準的なプリンタスプーラを利用してlips3dviを利用するた
めのフロントエンドプログラムです。dviprはlips3dvi(escpdvi)に渡したいオ
プションと、DVIファイルの内容を1つの出力ストリームにまとめ上げ、それを
lprプログラムに引き渡す働きをします。

dviprの書式は以下の通りです。
\begin{quote}
{\tt dvipr} \ob lips3dvi(escpdvi)へのオプション\cb  DVIファイル名 \ob
lprへのオプション\cb
\end{quote}

dviprは、指定されたオプションに矛盾が無い事、指定されたDVIファイルが存
在している事などを確認した上で、以下の形式の出力を行い、それをlprコマ
ンドにパイプで引き渡します。また、lprコマンドに対するオプションも指定
することができますので、出力先プリンタの選択などを行なうことができます。
\begin{center}
\begin{tabular}{|c|c|} \hline
\bf バイト数	& \bf 意味と機能 \\ \hline\hline
2		& IDコード(0x32e) \\ \hline
2		& オプション文字列の長さ{\it n} \\ \hline
{\it n}		& オプション文字列 \\ \hline
 & 以下、DVIファイルがそのまま送られる\\ \hline
\end{tabular}
\end{center}
なお、オプション文字列には、ユーザーが指定したものがそのままの形で
収められます。{\it DVIファイル名}と{\it lprへのオプション}は、出力スト
リームからは取り除かれます。

\begin{quote}
\noindent{\bf 注意\\
{\small\bf lprにコピー部数の指定を行なう場合({\it lpr -\#n\/})には、必
要な欧文フォントが全てダウンロードされていることを確認して下さい。プリ
ンタスプーラはフォントデータとページデータの区別がつきませんから、フォ
ントデータを複数回プリンタに送ってしまい、結果的にダウンロードオーバー
を引き起こすことがあります。コピー部数の指定には、dviprの``-c''オプショ
ンを使うとよいでしょう。}}
\end{quote}


\section{lipsback〜バックエンドプログラム}

lipsbackは、UNIXの標準的なプリンタスプーラを利用してlips3dvi(escpdvi)
を利用するためのバックエンドプログラムです。lipsbackは、lpr/lpdを経て
dviprの出力を受け取り、それを(dviprとは逆に){\bf lips3dvi(escpdvi)のオ
プション}と{\bf DVIファイル}に分割します。DVIファイルの部分をtmpファイ
ルに書きだし、その後、オプションとそのtmpファイル名を与えて
lips3dvi(escpdvi)を実行します。lips3dvi(escpdvi)の実行が終了すると、
tmpファイルを削除します。

つまり、dviprとlipsbackを組にして利用する事によって、lips3dvi(escpdvi)
の実行に必要な{\bf lips3dviのオプション}と{\bf DVIファイル}を、UNIXの
プリンタスプーラを通して、lips3dvi(escpdvi)に引き渡すことができます。


\section{注意点}

\begin{itemize}

\item	和文フォントとしてJXL4を利用することを指定した場合でも、該
当するフォントが見つからない場合には、内蔵フォントを使用して印刷を
続行します。その際、ワーニングメッセージが表示されます。

\item	和文フォントとしてJXL4を利用しない場合、``min\ast ''、
``goth\ast ''以外の日本語フォントは、コンフィギュレーションファイルの
font文を使用して、明示的に指定しなくてはなりません。デフォールトでは、
\pTeX の縦書きフォントも定義されていません。

\item	和文フォントとしてJXL4を利用している場合、プリンタへのデー
タの転送量は膨大になります。RS-232Cを使い、19200bpsでプリンタへの接続
を行っている場合、LaserShotがデータを取りこぼす事があります。プリント
キューを完全にクリアし、{\bf forcedownload}(-f)を指定して再度印刷を行っ
て下さい。

\item	LaserShotに「ダウンロードオーバー」のエラーメッセージが表
示された時は、{\bf forcedownload}(-f)を指定して印刷を行いなおします。
その際、プリンタキューを完全にクリアする事を忘れないようにして下さい。

\item	欧文フォントのダウンロードのために、LaserShotには、一般的
には少なくとも1MBのフリーメモリが必要です。テストプリントAで1MB以上の
メモリがフリーである事を確認して下さい。フリーメモリが少ない場合には、
プリンタ側のフォントキャッシュを減らすなどの対策を取って下さい。フリー
メモリが少ないと、オペレータコールでプリンタがハングしてしまう事があり
ます。{\bf downloadsize}を指定する事も有効ですが、これを指定すると、印
刷時にプリンタへのデータ転送量が膨大となってしまう場合があります。

\item	JXL4ファイルを用いた印刷を行う場合には、lips3dviがフォント
パターンのキャッシングを行います。キャッシュはフォントパターンの大
きさに依らず、キャッシングされている文字数で管理されていますので、
大きなフォントを多用した場合には、記憶領域が不足する場合があります。
(DOSの場合)。

\item	DOS版はプリンタへの出力をBIOSを通して行います。従ってプロ
グラムは機種依存です。現在はPC-9801シリーズ(高解像度も可\footnote{
テストはしていない。})と、J3100シリーズ、DOS/Vに対応しています。

\end{itemize}


\section{インストール}

\subsection{UNIX}

lips3dviをUNIXで利用する場合のインストール方法を以下に述べます。

\subsubsection{config.hの編集}

\midashi{マシンの選択}
config.hの先頭付近には、動作を確認したSun, NEWSに対応したシンボルを定
義する部分があります。インストールしたいマシンに対応するシンボルを
``1''に定義して下さい。

\midashi{プリンタの選択}
\LIPS とESC/Pageの選択を行ないます。先頭付近にあるシンボル{\bf LIPS3}
か{\bf ESCP}のいずれか一方を``1''に定義して下さい。\footnote{ソースファ
イル中では、{\bf ESCP}のみを参照しています。{\bf ESCP}が``0''の場合、
{\bf LIPS3}が選択されていると見なします。}

\midashi{各ファイルのパス指定}
以下のファイルのデフォールトパスをサイトの状況に合わせて定義します。複
数のディレクトリやファイルを指定することはできません。
\begin{center}
\begin{tabular}{|l|l|} \hline
\bf FONTDIR	& フォントファイル(グリフファイル)のあるディレクトリ名\\
\bf TFMDIR	& TFMファイルのあるディレクトリ名 \\
\bf DOWNINFO & ダウンロードインフォファイルのフルパス(ファイル)名\\
\bf CONFFILE & コンフィギュレーションファイルのフルパス(ファイル)名\\
\bf MAINPROG & lips3dvi(escpdvi)プログラム本体のフルパス(ファイル)名\\
\bf LPRCMD   & lprコマンド\\
\bf LPRDEFOPT & lprコマンドに必ず与えるオプション(-d)\\
\bf TMPFNAME & lipsbackが作成する一時ファイルのベース名 \\ \hline
\end{tabular}
\end{center}


\midashi{サポートフォントの選択}
ファイルの中程にサポートするフォントによってシンボルを定義する部分があ
りますので、サイトにインストールされているフォントに応じて、{\bf
PXLFONT}ないしは{\bf PKFONT}の少なくとも一方を``1''にします。両方を
``1''にした場合には、先に述べたようにPXLFONTから探してゆきます。なお、
UNIX版ではFARFONTフォーマット\footnote{{\bf 日本語micro\TeX}で使用して
いるフォントアーカイブのフォーマット。}はサポートしていませんので、
{\bf FARFONT}は必ず0にしておきます。

\midashi{日本語micro\TeX のサポート}
{\bf 日本語micro\TeX}の出力したDVIファイルを印刷する事がある場合には、
{\bf MICROTEX}を``1''にします。\footnote{{\bf 日本語micro\TeX}の出力す
るDVIファイルは、ポストアンブルの後ろが通常の\TeX とは異なる。}

\midashi{キャッシュサイズ}
JXL4フォントを使って印刷行う場合、lips3dvi(escpdvi)がキャッシングする
文字の数を{\bf CACHE\_SIZE}に指定します。SPARCstaionで5000を指定した場
合には、lips3dviは約700KBの仮想メモリを使用します。


\subsubsection{コンパイルとインストール}

Makefile.unxを使って、以下のようにmakeします。いずれも、ネイティブのC
コンパイラでしかテストしていません。
\begin{verbatim}
% make -f Makefile.unx lips      (LIPS3の時)
% make -f Makefile.unx escp      (ESC/Pageの時)
\end{verbatim}

コンパイルに成功したら、dvipr, lipsback, lips3dvi(escpdvi)を適当なディ
レクトリにインストールします。
\begin{verbatim}
% make -f Makefile.unx install
\end{verbatim}

\subsubsection{フォントのインストール}

lips3dvi(escpdvi)で出力を行なうには、少なくとも欧文のフォントが必要で
す。アスキーよりのj\TeX のディストリビューションには、欧文フォントが含
まれていませんので、オリジナル\TeX のディストリビューションからインス
トールを行ないます。初めてインストールするのであれば、とりあえず以下の
ディレクトリにある全てのファイルを適当なディレクトリ
(``/usr/local/lib/tex/pkfont''など)にコピーします。
\begin{itemize}
\item	tex2.99/cmfonts/pk/pk300/$*$
\item	tex2.99/LaTeXfonts/pk/pk300/$*$
\item	tex2.99/utilityfont/pk/pk300/$*$
\end{itemize}

色々なフォントを使っているドキュメントを出力するには、これだけのフォン
トでは不足ですが、とりあえずインストールを完了するには十分でしょう。フォ
ントに関する詳細は、付録と参考文献を参照してください。

\subsubsection{printcapの設定}

lips3dviは、フォントをバイナリでダウンロードしますので、lprは8ビットを
クリーンに出力できるように設定しなくてはなりません\footnote{\LIPS では、
バイナリイメージを16進数を表す文字列で転送する機能もありますが、転送量
が単純に倍になり、動作速度に多大な影響を及ぼすために本版では使っていま
せん。}。lips3dviがうまく動かないとの問い合わせの大部分は、printcapの
設定が8ビットクリーンになっていないことが原因でした。

ここで「8ビットクリーン」と言うのは、0x00から0xffまでの全ての文字が
「そのまま」プリンタに転送されるということを意味します。LFがCR+LFに変
換されたり、タブが空白に展開されたりしてはいけません。

一般論として、printcapが上記のような設定になっていることを確認するには、
次のような手順を取るとよいでしょう。lips3dviがうまく動かない時には、ま
ず次の手順でprintcapの設定を確認して下さい。
\begin{enumerate}
\item	0x00から0xffまでの256バイトから成るファイルを作成する。
\item	プリンタを16進ダンプモードにする。
\item	フィルタを使わずに(printcapのifフィールドを空にして)、そのファ
イルをプリンタに出力してみる。
\item	16進ダンプの結果を見て、すべてのバイトがそのまま出力されている
ことを確認する。特に0x08(TAB)と0x0a(LF)、0x0d(CR)に注意する\footnote
{これらの文字は、ttyドライバによって変更されることがある。}。
\end{enumerate}

8ビットクリーンになっていることを確認したならば、DVIファイルの出力フィ
ルタとして、lipsbackを指定します。つまり、LaserShotのエントリに次のよ
うな項目を追加します。$$df=/usr/local/lib/tex/lipsback$$なお、lipsback
はアカウンティングの機能は持っていません。

SunOS 4.1において、lips3dviを利用する際のprintcapの例を示します。お使
いになっている他のフィルタ群とのかねあいもありますので、printcapならび
に他のフィルタ群のマニュアルを参照して設定を行なって下さい。
\begin{verbatim}
    lp|ls|Cannon LaserShot2:\
            :lp=/dev/ttya:sd=/var/spool/lpd:br#19200:\
            :fs#06020:fc#300:ms=-opost,-parity,ixon:\
            :df=/usr/local/lib/tex/lipsback:sh:\
            :if=/usr/local/lib/lips3text:
\end{verbatim}


\subsubsection{他の機種の場合}

lips3dviは、System VでUNIXを覚えたプログラマが「MS-DOSでも動かそう」と
考えながら作ったものです。System Vのライブラリルーチンが多数使われてい
ます。デバッグ用のものを除く全ての記号定数はconfig.hにありますので、こ
れをよく読んで適当なdefineを切って下さい。健闘をお祈りいたします。


\subsection{MS-DOS}

lips3dvi(escpdvi)をMS-DOSで利用する場合のインストール方法を以下に述べ
ます。なお、MS-DOS版はMicrosoft C compiler V 6.0を前提としています
\footnote{旧版はV5.1対応でした。}。他の処理系でのテストは行っていませ
ん。また、Makefile.dosは、Cコンパイラに付属のnmakeを想定しています
\footnote{UNIX互換のものであれば、そのまま流用可能と思われます。メモリ
不足などでnmakeが使えない事があります。}。

\subsubsection{config.hの編集}

\midashi{マシンの選択}
config.hの先頭付近には、動作を確認したPC98, J3100、DOS/Vに対応したシン
ボルを定義する部分があります。インストールしたいマシンに対応するシンボ
ルを``1''に定義して下さい。MS-DOS版のlips3dvi(escpdvi)では、BIOS呼び出
し、またはハードウェアポートを直接制御することてプリンタにデータを送り
ますので、オブジェクトは機種依存です。\footnote{DOSのファンクションコー
ルだけでプリンタにビットマップデータを送る(漢字コードの変換機能を解除
する)方法をご存知の方はご一報頂ければ幸いです。Rowモードに設定するだけ
ではダメでした。}

\midashi{プリンタの選択}
\LIPS とESC/Pageの選択を行ないます。先頭付近にあるシンボル{\bf LIPS3}
か{\bf ESCP}のいずれか一方を``1''に定義して下さい。\footnote{ソースファ
イル中では、{\bf ESCP}のみを参照しています。{\bf ESCP}が``0''の場合、
{\bf LIPS3}が選択されていると見なします。}

\midashi{EMSサポートの有無}
V2.07から、EMSサポート機能が追加されました。欧文フォントのビットマップ
をEMSメモリを使って展開することができます。この機能を有効にする場合に
は、{\bf USEEMS}を``1''にします。

\midashi{各ファイルのパス指定}
以下のファイルのデフォールトパスをサイトの状況に合わせて定義します。複
数のディレクトリやファイルを指定することはできません。
\begin{center}
\begin{tabular}{|l|l|} \hline
\bf FONTDIR	& フォントファイル(グリフファイル)のあるディレクトリ名
\\
\bf TFMDIR	& TFMファイルのあるディレクトリ名 \\
\bf DOWNINFO & ダウンロードインフォファイルのフルパス(ファイル)名\\
\bf CONFFILE & コンフィギュレーションファイルのフルパス(ファイル)名\\ \hline
\end{tabular}
\end{center}

\midashi{サポートフォントの選択}
ファイルの中程にサポートするフォントによってシンボルを定義する部分があ
りますので、マシンにインストールされているフォントに応じて、{\bf
PXLFONT}ないしは{\bf PKFONT}の少なくとも一方を``1''にします。FARフォン
トアーカイブを利用する場合には、{\bf PXLFONT}と{\bf FARFONT}を``1''に
しなくてはなりません\footnote{FARフォントアーカイブには、pxlフォーマッ
トでフォントがアーカイブされているため。}。複数の形式に``1''を指定した
場合には、先に述べたようにFARFONTから探してゆきます。

\midashi{日本語micro\TeX のサポート}
{\bf 日本語micro\TeX}の出力したDVIファイルを印刷する事がある場合には、
{\bf MICROTEX}を``1''にします。\footnote{{\bf 日本語micro\TeX}の出力す
るDVIファイルは、ポストアンブルの後ろが通常の\TeX とは異なる。}

\midashi{キャッシュサイズ}
JXL4フォントを使って印刷行う場合、lips3dvi(escpdvi)がキャッシングする
文字の数を{\bf CACHE\_SIZE}に指定します。プリンタ側が絶対的に律速とな
りますので、大きくしたからと言って早くなるものでもありません。

\subsubsection{コンパイルとインストール}

MS-C 6.0に付属のnmake.exeとMakefile.dosを使って次のようにmakeします。
\begin{verbatim}
c:>nmake -f makefile.dos lips      (LIPS3の時)
c:>nmake -f makefile.dos escp      (ESC/Pageの時)
\end{verbatim}
nmakeは大量のメモリを消費するので、コンパイラの作業領域が取れない場合
があります。Makefile.dosの中にnamkeに固有の記述はありませんので、その
ような場合にはUNIX互換のmakeユーティリティを使用してください。

コンパイルに成功したら、lips3dviを適当なディレクトリ\footnote{PATHに含
まれているディレクトリ。}にコピーします。

\subsubsection{フォントのインストール}

\TeX における一般的なフォントの命名規則は、DOSにおけるファイル名の制限
(ベース名8文字+拡張子3文字)を越えてしまいます。そのためlips3dviでは、
次のようなフォント命名規則を使っています\footnote{互換性などのために日
本語micro\TeX と同じ命名規則も使えます。micro\TeX をお使いにならない場
合は新しい命名規則を使うようにして下さい。}。

通常の\TeX におけるフォントの名前は、
\begin{quote}
{\tt $<$フォント名$><$デザインサイズ$>$.$<$解像度$>$pk}(PKフォント)\\
{\tt $<$フォント名$><$デザインサイズ$>$.$<$拡大率$>$pxl}(pxlフォント)
\end{quote}
となっています。{\bf 解像度}とは、フォントの大きさを示す数値だと考えれ
ばよいでしょう。その{\bf 解像度}を5倍したものを{\bf 拡大率}と呼びます。

pkフォントの場合、
\begin{enumerate}
\item	``$<$解像度$>$pk''を名前とするサブディレクトリを作成する。
\item	フォントファイルの名前を$<$解像度$>$を取り去った名前に変更する。
\item	1)で作成したサブディレクトリにファイルをコピーする。
\end{enumerate}
例えば、``cmr10.300pk''の場合であれば、``300pk''というサブディレクトリ
に``cmr10.pk''という名前のファイルとしてコピーします。また、
``cms8.360pk''の場合であれば、``360pk''というサブディレクトリに
``cms8.pk''という名前でコピーします。\TeX ディストリビューションから、
下に記した全てのPKフォントファイルを、名前を変えて適当なサブディレクト
リにコピーして下さい。

pxlフォントの場合、
\begin{enumerate}
\item	``$<$拡大率$>$pxl''を名前とするサブディレクトリを作成する。
\item	フォントファイルの名前を$<$拡大率$>$を取り去った名前に変更する。
\item	1)で作成したサブディレクトリにファイルをコピーする。
\end{enumerate}
例えば、``cmr10.1500pxl''の場合であれば、``1500pxl''というサブディレク
トリに``cmr10.pxl''という名前のファイルとしてコピーします。また、
``cms8.1800pxl''の場合であれば、``1800pxl''というサブディレクトリに
``cms8.pxl''という名前でコピーします。

lips3dvi(escpdvi)で出力を行なうには、少なくとも欧文のフォントが必要で
す。アスキーよりのj\TeX のディストリビューションには、欧文フォントが含
まれていませんので、オリジナル\TeX のディストリビューションからインス
トールを行ないます。初めてインストールするのであれば、とりあえず以下の
ディレクトリにある全てのファイルをインストールすればよいでしょう。
\begin{itemize}
\item	tex2.99/cmfonts/pk/pk300/$*$
\item	tex2.99/LaTeXfonts/pk/pk300/$*$
\item	tex2.99/utilityfont/pk/pk300/$*$
\end{itemize}

上記のPKフォントをインストールする場合には、上記のように解像度毎にサブディ
レクトリを作成し、フォントファイルの名前を変更してコピーして下さい。

色々なフォントを使っているドキュメントを出力するには、これだけのフォン
トでは不足ですが、とりあえずインストールを完了するには十分でしょう。フォ
ントに関する詳細は、付録と参考文献を参照してください。


\subsubsection{他の機種の場合}

機種に依存するBIOS呼び出し(あるいはハードウェアポートの直接制御)は、
dosprn.cなるファイルにのみ存在しています。必要な機能は
\begin{itemize}
\item	プリンタBIOSの初期化
\item	プリンタへの1バイト出力
\end{itemize}
だけですので、移植は容易なはずです。健闘を祈ります。


\subsection{コンフィギュレーションファイルの設定}

同梱のlips3dvi.cnfには、コンフィギュレーションファイルで利用できる
全てのコマンドが書かれています。コメントになっている項目は、通常は
指定しません。lips3dviの説明をよく読んで、各項目を適当に設定して下
さい。

{\bf porth\_base, portv\_base, landh\_base, landv\_base}の4つは、ほと
んどの場合、デフォールト値では不適当です\footnote{原理的にばらつきが避
けられないものであるらしい。}。実際に印刷を行ってみて、印字位置の左上
隅が縦横とも1inchになるようにそれぞれの値を設定します。具体的な設定方
法については、``pageadj.tex''を参照してください。


\LIPS において、ゴチックのプロポーショナルフォントカードをお持ちでない
場合には、
\begin{verbatim}
    FONT        goth       J80W22Y
\end{verbatim}
を指定します。もちろん、この場合はゴチック指定があっても明朝体で印刷さ
れます。また、丸ゴチックカードをお持ちの場合は`J82W2Y'を指定します。角
ゴチックと丸ゴチックの両方をお持ちの場合は好きな方を選んで下さい。本来
の大日本フォントは、どちらかと言えば角ゴチックに近い書体です。

LaserShotのメモリが少ない場合(A406SやA404にて0.5MBしか増設していない場
合や、A406Eでメモリを増設していない場合)には、{\bf downloadsize}を指定
する必要があるかも知れません。大きな(色々な英文フォントを利用した)ファ
イルを印刷してみて、「ダウンロードオーバー」が表示されないように、適当
な値を設定して下さい。なお、{\bf downloadsize}に小さな値を設定すると、
プリンタへダウンロードされるデータは減りますが、その分だけlips3dviが消
費するメモリの量が増えます。EMSサポート無しのDOSでは動かなくなるかも知
れませんので御注意下さい。


\section{Copyrights}

lips3dviは、\KK アスキー 出版局出版技術部の依頼をうけて\YK エヌ・エス・
プランニングが作成したもので、著作権は\KK アスキーが保持しています。ま
た、ESC/Page対応ならびにEMSのサポートは、岩本明氏によって行なわれまし
た。岩本氏による改造部分の著作権は岩本氏が保持していますが、利用・配付
などの条件は以下に準じます。

\begin{itemize}

\item その使用が直接的な営利目的（たとえば、利用者にプログラムの使
    用料金をとる等）でない限り、どのような方法、目的で使用しても
    かまいません。

\item 他者へのコピーは、その行為が営利目的でない限り、自由に行うこ
    とができます。

\item プログラムの改変については自由に行うことができます。ただし、
    他者へのコピーに関しては、改変前のもの、あるいは改変前の状態
    に簡単に戻せる形で行ってください。
    改変の内容についてはアスキーへの通知義務があるものとし、その
    公開については事前の承諾を必要とします。

\end{itemize}
lips3dviならびにその関連プログラムの利用に起因して利用者が何らか
の損害を被った場合であっても、\KK アスキーならびに\YK エヌ・エ
ス・プランニング、岩本明は一切の責を負いません。

\newpage
\appendix
\section{\TeX のフォントについて}
\subsection{欧文フォント}
\TeX で利用するフォントは、\mf というシステムによって作成されま
す。\mf は、特殊なプログラム言語で記述されたフォントのアウトラインデー
タを読み込んで「{\bf メトリックファイル}」と「{\bf グリフファイル}」を
出力します。メトリックファイルには、フォントのメトリック情報(文字の幅、
傾きなど)が、グリフファイルにはフォントのビットマップ情報が含まれてい
ます。メトリックファイルは、TFM(\TeX Font Metric)ファイルとも呼ばれ、
\TeX 本体とプリンタドライバの両方で参照されます。\TeX 本体と同時にイン
ストールした``$*$.tfm''というファイルが、このメトリックファイルの実体
です。

グリフファイルには、そのフォーマットによって幾つかの種類があります。
\mf が出力するのは、GF(Generic Font)というフォーマットのグリフファ
イルで、
\begin{quote}
{\tt $<$フォント名$><$デザインサイズ$>$.$<$解像度$>$gf}
\end{quote}
という名前になっています。ここで、{\bf デザインサイズ}いうのは、そのフォ
ントを設計するときに想定した大きさを、{\bf 解像度}というのは、そのフォ
ントが何dpiの出力デバイス用に作られているかを示します。300dpiの出力デ
バイスに360dpi用のフォントを出力すれば、$360/300=1.2$倍の大きさで出力
されますから、{\bf 解像度}はフォントのサイズも示しています。

さて、GFフォーマットはビットマップの圧縮率が低く、ディスクスペースが無
駄なので、通常はより圧縮率が高いグリフファイルフォーマットが使われます。
最もポピュラーなものが、PK(PacKed)と呼ばれるフォーマットです。これは、
GFフォーマットのファイルからコンバートして作ります。幾つかのコンバータ
がありますが、\TeX のディストリビューションには`gftopk'というものが含
まれています(TeX2.99/tex82/mfware/gftopk.web)。PKフォーマットのグリフ
ファイルは、
\begin{quote}
{\tt $<$フォント名$><$デザインサイズ$>$.$<$解像度$>$pk}
\end{quote}
という名前になっています。

また別のグリフフォーマットとして、PXLと呼ばれるフォーマットもあります。
一般にPXLフォーマットと呼ばれるものには、その圧縮形式によって3種類あり
ますが、いずれも
\begin{quote}
{\tt $<$フォント名$><$デザインサイズ$>$.$<$拡大率$>$pxl}
\end{quote}
という名前になっています。ここで、{\bf 拡大率}は、PKフォーマットやGFフォー
マットにおける{\bf 解像度}を5倍にした値です\footnote{解像度の計算にお
いて端数は切り捨てられるので、必ずしもGFフォーマットなどの{\bf 解像度}
の5倍ちょうどの値になるとは限らない。}。これも、PKフォーマットと同様に、
GFフォーマットのファイルからコンバートして作ります。圧縮形式などにより、
幾つかのコンバータが提供されています。

いずれのフォーマットの場合であっても、1フォントが1つのファイルとなるの
で、多数のファイルが必要となります。これは、DOSのようにファイルの管理
単位(クラスタ)が大きいOSでは、ディスクスペースの無駄が増えることを意味
します。そこで、DOS用の\TeX であるmicro\TeX では、幾つかのグリフファイ
ルを1つにまとめた(アーカイブした)FAR(Font ARchive)フォーマットを採用し
ています。これは、いくつかのPXLフォーマットのグリフファイルをまとめて、
1つの
\begin{quote}
{\tt $<$拡大率$>$.FAR}
\end{quote}
という名前のファイルとしたものです。micro\TeX のプリンタドライバに付属
の``far.exe''というプログラムを使って、PXLファイルから作ることができま
す\footnote{``far.exe''はフリーウェアではありません。}。

\TeX 本体は、その実行にグリフファイルを必要としませんが、プリンタドラ
イバは実際に文字を出力する必要があるので、いずれかのフォーマットのグリ
フファイルを必要とします。lips3dviでは、FARフォーマット(DOS版のみ)、PK
フォーマット、PXLフォーマット(全種類)をサポートしています。UNIXでは、
入手が容易で圧縮率が高いPKフォーマットを使うとよいでしょう。DOSで、
micro\TeX をお使いであれば、ディスクスペースが少なくて済むFARフォーマッ
トを使うとよいでしょう。

\subsection{和文フォント}

和文フォントにも、欧文フォントと同様にメトリックファイルとグリフファイ
ルが存在します。アスキー版日本語\TeX では、独自のJFMフォーマットと呼ば
れるメトリックファイルを必要とします。JFMフォーマットのメトリックファ
イルは、欧文のメトリックファイルと同様に``$*$.tfm''という名前を持ち、
アスキーからのディストリビューションに含まれています。

グリフファイルとして、アスキー版日本語\TeX ではJXL4と呼ばれる特殊なフォー
マットのファイルを使用しています。GFフォーマットやPKフォーマットなどの
欧文グリフ用フォーマットでは、日本語のように多数の文字を格納することが
できないからです。JXL4フォーマットの和文グリフファイルの名前は、PXLフォー
マットの欧文ファイルと同じ形式になっています。この日本語グリフファイル
は、大日本印刷\KK から有償で提供されています。\KK ディアイティなど、い
くつかの会社で、この大日本フォントの配付代行サービスを行なっていますの
で、必要な場合はお問い合わせ下さい。

lips3dviは、LaserShot(\LIPS)やLP-3000(ESC/Page)内蔵のスケーラブルフォ
ントを使って日本語を印刷する機能を持っていますので、和文フォントは必要
ありません。ただし、欧文とのバランスや、約物の位置が微妙に異なる場合が
あります。大日本フォントを使って印刷を行なうこともできますが、印刷速度
などの点からあまりおすすめはいたしません。

\subsection{フォントのインストール}

UNIXにてlips3dviをお使いになる場合には、メトリックファイルとグリフファ
イルを、そのままの名前で適当なディレクトリに置いて下さい。コンフィギュ
レーションファイルにて、メトリックファイルを置いたディレクトリ名を
`tfmdir'に、グリフファイルを置いたディレクトリ名を`fontdir'に、それぞ
れ指定します。

例えば、欧文メトリックを`/tex/tfm'、和文メトリックを`/tex/jfm'、欧文グ
リフを`/tex/pkfonts'と`/tex/pxlfonts'、和文グリフを`/tex/jxlfonts'に置
いた場合には、コンフィギュレーションファイルにて次のように指定します。
\begin{verbatim}
    tfmdir      /tex/tfm;/tex/jfm
    fontdir     /tex/pkfonts;/tex/pxlfonts;/tex/jxlfonts
\end{verbatim}

DOSにてlips3dviをお使いになる場合、メトリックファイルはUNIXと同様に1つ
のディレクトリにまとめて置いて下さい。グリフファイルは、お使いになるフォ
ントフォーマットに合わせて、次のようにサブディレクトリを作成して、そこ
に名前を変更したフォントファイルを置きます。

\noindent{\bf pkフォントの場合:}\\
フォント名に含まれる{\bf 解像度}毎に``$<$解像度$>$pk''なるサブディレク
トリを作成します。各フォントファイルの名前からは、解像度を示す数値を取
り除き、適当な解像度のサブディレクトリに置きます。例えば、
``cmr10.300pk''の場合であれば、``300pk''というサブディレクトリに
``cmr10.pk''という名前のファイルとしてコピーします。また、
``cms8.360pk''の場合であれば、``360pk''というサブディレクトリに
``cms8.pk''という名前でコピーします。

\noindent{\bf pxlフォントの場合:}\\
フォント名に含まれる{\bf 拡大率}毎に``$<$拡大率$>$pxl''なるサブディレ
クトリを作成します。各フォントファイルの名前からは、拡大率を示す数値を
取り除き、適当な解像度のサブディレクトリに置きます。例えば、
``cmr10.1500pxl''の場合であれば、``1500pxl''というサブディレクトリに
``cmr10.pxl''という名前のファイルとしてコピーします。また、
``cms8.1800pxl''の場合であれば、``1800pxl''というサブディレクトリに
``cms8.pxl''という名前でコピーします。

\noindent{\bf farファイルの場合:}\\
1つのfarファイルには、同じ拡大率を持つ複数のpxlフォントが含まれていま
す\footnote{詳しくはfar.exeのマニュアルを参照してください。}。各farファ
イルを、フォントディレクトリにそのままおいて下さい。

なお、旧版ならびにmicro\TeX との互換性のために、lips3dviでは次に示すディ
レクトリからもフォントを検索します。
\begin{itemize}
\item	`{\bf 拡大率}'なるサブディレクトリから、その拡大率を持つpxlファ
イルを探す。
\item	`{\bf 拡大率}'なるサブディレクトリから、その拡大率に相当する解
像度を持つpkファイルを探す。
\end{itemize}
micro\TeX をお使いにならないのであれば、先に述べた様に「フォントタイプ
毎にディレクトリ名を分ける」方法でインストールすることをお勧めします。


\subsection{参考文献}

\TeX のフォントについて、より詳しく知りたい場合には、以下の参考文献を
参照してください。
\begin{quote}
「日本語\TeX テクニカルブック1」 アスキー\\
アスキー出版技術部責任編集\\
ISBN4-7561-0405-3
\end{quote}

\section{おまけプログラム}

\subsection{レーザーショットの網掛けパターン}
lips3dviの和文代用フォントの機能にて、LaserShotの網掛け機能を利用する
ことができます。LaserShotには69種類の網掛けパターンが内蔵されています
が、その詳細についてはオプションのプログラマーズリファレンスマニュアル
にしか記述されていません。利用の便を考えて、この内蔵網掛けパターンの一
覧を印刷するためのプログラムを添付しました。以下の手順にて、patlistプ
ログラムを作成して実行すると、内蔵網掛けパターンの一覧が得られます。

\subsubsection{UNIX}
\begin{enumerate}
\item	`make -f Makefile.unx patlist'にて、patlistを作成する。
\item	patlistの出力がフィルタを通らずにプリンタに渡るように、
printcapからifエントリを取り除く。
\item	`patlist ｜lpr'にて、patlistの出力をプリンタに送る。
\end{enumerate}

\subsubsection{DOS}
\begin{enumerate}
\item	`nmake -f makfile.dos patlist.exe'にて、patlist.exeを作成する。
\item	`patlist'にてパターン一覧を出力する(BIOSを利用するので、デバイ
スドライバの有無は問わない)。
\end{enumerate}

\subsubsection{DOS用echoコマンド}
DOSのechoコマンドは機能が少ないので、UNIXのechoに相当するdisp.exeプロ
グラムを用意しました。このプログラムは、makeの課程で自動的に作られます。
用法などについては、ソースを参照してください。


\begin{flushright}
{\bf 以上}
\end{flushright}

\end{document}
