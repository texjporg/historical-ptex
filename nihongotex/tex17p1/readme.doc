アスキー日本語 TeX 2.99 - j1.7 - p1.0 パッチについて

                                                            25 - FEB -1993

　現在の ASCII-TeX では漢字の処理に難点があり、たとえば \let（および同種
のプリミティブである \futurelet \futurenospacelet \global\let 
\afeterassignment など）によってコントロールシーケンスに 2バイト文字を代
入できない、\if （および \ifcat）によって 2バイト文字を比較することができ
ない、2バイト文字を含むマクロのパターンマッチングに失敗するなどの問題が
あります。

今回のパッチはそれらの問題を解消するものですがそのためにごくわずかだけ
仕様を変更する必要がありました。

　まず、2バイト文字のカテゴリは完全に固定となります。従来も 2バイト文字の
カテゴリを変更することは禁止、と規定されていたので特に問題は発生しないと
思います。日本語 TeX テクニカルブックでは「英字のカテゴリを 16 以
上に変更することは危険度が高いので注意が必要」とありますが、今回「16 以
上へのカテゴリ変更は一切禁止」と明確に規定することにします。（いままで
も 16 以上への変更は単にバグるだけで無意味だったので機能的には問題な
い。）

　\string によって 2バイト文字を含むコントロールシーケンス名を文字に展開
した時に、従来のアスキー日本語 TeX では全ての 2バイト文字がカテゴリ 18 
（その他の全角文字）に変更されますが、このパッチでは 2 バイト文字のカテ
ゴリは固定なので漢字、かなのカテゴリはそれぞれ 16, 17 のままです。
　カテゴリ 18 は CS 名として登録するときに最初の１文字しか有効にならない
ことだけが他の 2バイト文字(漢字、かな)と異なる点です。したがって、\string 
でつくった文字列から CS 名を(\def などで）定義しようとしたときに、従来は
最初の１文字のみ CS 名として有効であったところが、今回の変更で 2 文字以
降も CS として有効になり、動作が異なる場合がありえます。しかし、この従
来仕様もやはり無意味であり、なんらかの機能として使われているケースは存在
しなかったと思われます。

  また、\endlinechar=-1 の際に全角 1文字のコントロールシーケンスが行の終
りにあると動かないバグもフィックスしてあります。

差分のあてかた

j1.7 のチェンジファイルからのソース差分です。

bigctex.dif は TeX 用の差分です。
bigpctex.dif は PTeX 用の差分です。
EUC/SJIS , Big/ふつう にかかわらず適用できますので
patch するチェンジファイル名を書き込んでむりやり patch してください。
EUC の場合は パッチファイルの漢字コードを EUC に変換してから
おこなってください。 patch の訴える文句は無視して下さい。
banner の部分で fail したら
それぞれの banner に "- p1.0" をつけて
! @d banner=='This is BigTeX, C Version 2.99 - j1.7 - p1.0'
こんな感じにしてバージョンを替えておいてください。

このパッチについてはアスキーからは TeX 改変公開許可をとってありますので
ご自由に配布して下さい。

このパッチに関するご意見、ご質問は次までおよせください。

小林　誠　　三重大学工学部

na70103@mips.cc.mie-u.ac.jp
xsg19897@pcvan.or.jp
ghg00014@niftyserve.or.jp
